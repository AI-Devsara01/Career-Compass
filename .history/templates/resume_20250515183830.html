<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Keep all your existing head content -->
</head>
<body>
  <!-- Keep your existing header -->

  <div class="container">
    <div class="upload-section" id="uploadSection">
      <div class="upload-container">
        <div class="upload-icon">
          <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <h2>Upload Your Resume</h2>
        <p>Get personalized career recommendations and ATS optimization tips</p>
        <input type="file" id="resumeUpload" class="file-input" accept=".pdf,.doc,.docx">
        <label for="resumeUpload" class="file-label">Choose File</label>
        <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-light);">Supports PDF, DOC, DOCX (Max 5MB)</p>
      </div>
    </div>

    <div class="results-section" id="resultsSection">
      <!-- ATS Score Card -->
      <div class="score-card">
        <div class="score-header">
          <div>
            <h2>Resume ATS Score</h2>
            <p class="score-label">How well your resume performs in Applicant Tracking Systems</p>
          </div>
          <div class="score-value" id="atsScore">0</div>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <p id="atsFeedback">Analyzing your resume...</p>
      </div>

      <!-- Best Role Match -->
      <div class="role-match">
        <div class="role-header">
          <h2 class="role-title" id="bestRole">Best Career Match</h2>
          <div class="role-score" id="roleScore">0%</div>
        </div>
        <p class="role-description" id="roleDescription">Our AI is analyzing your skills and experience...</p>
        
        <h3>Key Skills Matched</h3>
        <div class="skills-list" id="skillsList">
          <!-- Skills will be inserted here by JavaScript -->
        </div>

        <div class="other-roles">
          <h3>Other Potential Matches</h3>
          <div id="otherRoles">
            <!-- Other roles will be inserted here by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Improvement Suggestions -->
      <div class="improvements-section">
        <h2>Improvement Suggestions</h2>
        <p>Enhance your resume based on our analysis</p>
        <div id="improvementsList">
          <!-- Improvements will be inserted here by JavaScript -->
        </div>
      </div>

      <!-- Experience Summary -->
      <div class="experience-section">
        <h2>Experience Summary</h2>
        <div id="experienceSummary">
          <!-- Experience will be inserted here by JavaScript -->
        </div>
      </div>

      <a href="/roles" class="btn">Explore Career Roadmaps</a>
    </div>
  </div>

  <script>
    // Theme Toggle Functionality (keep existing)
    
    // File Upload Handling
    const fileInput = document.getElementById('resumeUpload');
    const uploadSection = document.getElementById('uploadSection');
    const resultsSection = document.getElementById('resultsSection');
    
    fileInput.addEventListener('change', async (e) => {
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        
        // Validate file size
        if (file.size > 5 * 1024 * 1024) {
          alert('File size exceeds 5MB limit');
          return;
        }
        
        // Show loading state
        uploadSection.innerHTML = `
          <div class="upload-container">
            <div style="margin-bottom: 1.5rem;">
              <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary-color);"></i>
            </div>
            <h2>Analyzing Your Resume</h2>
            <p>This may take a few moments...</p>
            <div style="width: 100%; height: 8px; background: var(--secondary-color); border-radius: 4px; margin-top: 2rem;">
              <div id="analysisProgress" style="width: 0%; height: 100%; background: var(--primary-color); border-radius: 4px;"></div>
            </div>
          </div>
        `;
        
        // Simulate progress (real progress would come from server events)
        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += 5;
          document.getElementById('analysisProgress').style.width = `${Math.min(progress, 90)}%`;
          if (progress >= 90) clearInterval(progressInterval);
        }, 200);
        
        // Prepare form data
        const formData = new FormData();
        formData.append('resume', file);
        
        try {
          // Send to server for analysis
          const response = await fetch('/resume/upload', {
            method: 'POST',
            body: formData
          });
          
          const data = await response.json();
          
          if (response.status !== 200) {
            throw new Error(data.error || 'Analysis failed');
          }
          
          // Show results
          uploadSection.style.display = 'none';
          resultsSection.style.display = 'block';
          displayResults(data);
        } catch (error) {
          console.error('Error:', error);
          uploadSection.innerHTML = `
            <div class="upload-container">
              <div style="margin-bottom: 1.5rem; color: var(--danger);">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
              </div>
              <h2>Analysis Failed</h2>
              <p>${error.message}</p>
              <button onclick="window.location.reload()" class="file-label" style="margin-top: 1.5rem;">Try Again</button>
            </div>
          `;
        }
      }
    });
    
    function displayResults(results) {
      // Update ATS Score
      document.getElementById('atsScore').textContent = results.ats_score;
      document.getElementById('progressBar').style.width = `${results.ats_score}%`;
      document.getElementById('atsFeedback').textContent = results.ats_feedback;
      
      // Update Role Match
      document.getElementById('bestRole').textContent = results.role_match.best_match;
      document.getElementById('roleScore').textContent = `${results.role_match.match_score}%`;
      document.getElementById('roleDescription').textContent = results.role_match.role_details.description;
      
      // Update Skills
      const skillsList = document.getElementById('skillsList');
      skillsList.innerHTML = '';
      results.skills.forEach(skill => {
        const skillTag = document.createElement('div');
        skillTag.className = 'skill-tag';
        skillTag.textContent = skill;
        skillsList.appendChild(skillTag);
      });
      
      // Update Other Roles
      const otherRoles = document.getElementById('otherRoles');
      otherRoles.innerHTML = '';
      results.role_match.top_matches.forEach(match => {
        const roleItem = document.createElement('div');
        roleItem.className = 'role-item';
        roleItem.innerHTML = `
          <span>${match.role}</span>
          <span>${match.score}% match</span>
        `;
        otherRoles.appendChild(roleItem);
      });
      
      // Update Improvements
      const improvementsList = document.getElementById('improvementsList');
      improvementsList.innerHTML = '';
      results.improvements.forEach(improvement => {
        const improvementItem = document.createElement('div');
        improvementItem.className = 'improvement-item';
        improvementItem.innerHTML = `
          <div class="priority priority-${improvement.priority}">${improvement.priority}</div>
          <div>
            <h4>${improvement.text}</h4>
          </div>
        `;
        improvementsList.appendChild(improvementItem);
      });
      
      // Update Experience
      const experienceSummary = document.getElementById('experienceSummary');
      experienceSummary.innerHTML = '';
      
      const yearsItem = document.createElement('div');
      yearsItem.className = 'experience-item';
      yearsItem.innerHTML = `
        <h3 class="experience-title">Years of Experience</h3>
        <p>${results.experience.years}+ years</p>
      `;
      experienceSummary.appendChild(yearsItem);
      
      if (results.experience.education && results.experience.education.length > 0) {
        const educationItem = document.createElement('div');
        educationItem.className = 'experience-item';
        educationItem.innerHTML = `
          <h3 class="experience-title">Education</h3>
          <ul style="list-style-position: inside;">
            ${results.experience.education.map(edu => `<li>${edu}</li>`).join('')}
          </ul>
        `;
        experienceSummary.appendChild(educationItem);
      } else {
        const educationItem = document.createElement('div');
        educationItem.className = 'experience-item';
        educationItem.innerHTML = `
          <h3 class="experience-title">Education</h3>
          <p>No education information found in resume</p>
        `;
        experienceSummary.appendChild(educationItem);
      }
    }
  </script>
</body>
</html>